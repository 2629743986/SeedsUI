<!doctype html>
<html>
<head>
	<meta charset="utf-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
	<title>tree-selected</title>
	<link rel="stylesheet" href="../plugin/seedsui/seedsui.min.css">
</head>

<body>
    <section id="page_treeSelected" class="active">
        <header>
           <div class="titlebar">
                <a id="closeSelectPage">
                    <i class="icon-arrowleft"></i>
                    <span>确定</span>
                </a>
                <h1 class="text-center">选择人员</h1>
            </div>
            <div class="selected-display"></div>
        </header>
        <article>
            <div class="statusbar horizontal hide" id="selected-box" style="height:46px;"></div>
            <!-- tree -->
            <div class="tree-box">
                <ul class="tree" id="tree">
                    <li id="group-1" data-name="业务产品部">
                        <div class="treetitle"> <i class="treeicon"></i>
                            <span class="icon-persons round events-none"></span>
                            <a class="icontitle events-none">业务产品部</a>
                            <a class="icon icon-rdoadd right middle"></a>
                        </div>
                        <ul>
                            <li id="group-2" data-name="研发体系">
                                <div class="treetitle">
                                    <i class="treeicon"></i>
                                    <span class="icon-persons round events-none"></span>
                                    <a class="icontitle events-none">研发体系</a>
                                    <a class="icon icon-rdoadd right middle"></a>
                                </div>
                                <ul>
                                    <li id="group-3" data-name="开发一部">
                                        <div class="treetitle">
                                            <i class="treeicon"></i>
                                            <span class="icon-persons round events-none"></span>
                                            <a class="icontitle events-none">开发一部</a>
                                            <a class="icon icon-rdoadd right middle"></a>
                                        </div>
                                        <ul>
                                        	<li id="group-4" data-name="成少波">
                                        		<div class="treetitle">
                                        			<span class="round" style="background-color: #53c6fd;">波</span>
		                                            <a class="icontitle events-none">成少波</a>
		                                            <a class="icon icon-rdoadd right middle"></a>
		                                        </div>
                                        	</li>
                                        	<li id="group-5" data-name="颜学文">
                                        		<div class="treetitle">
                                        			<span class="round" style="background-color: #3ae3ea;">文</span>
		                                            <a class="icontitle events-none">颜学文</a>
		                                            <a class="icon icon-rdoadd right middle"></a>
		                                        </div>
                                        	</li>
                                        	<li id="group-6" data-name="张泉">
                                        		<div class="treetitle">
                                        			<span class="round" style="background-color: #ff6f36;">泉</span>
		                                            <a class="icontitle events-none">张泉</a>
		                                            <a class="icon icon-rdoadd right middle"></a>
		                                        </div>
                                        	</li>
                                        </ul>
                                    </li>
                                    <li id="group-7" data-name="开发二部">
                                        <div class="treetitle">
                                            <i class="treeicon"></i>
                                            <span class="icon-persons round events-none"></span>
                                            <a class="icontitle events-none">开发二部</a>
                                            <a class="icon icon-rdoadd right middle"></a>
                                        </div>
                                    </li>
                                    <li id="group-8" data-name="开发三部">
                                        <div class="treetitle">
                                            <i class="treeicon"></i>
                                            <span class="icon-persons round events-none"></span>
                                            <a class="icontitle events-none">开发三部</a>
                                            <a class="icon icon-rdoadd right middle"></a>
                                        </div>
                                        <ul>
                                            <li id="group-9" data-name="开发一部">
                                                <div class="treetitle">
                                                    <i class="treeicon"></i>
                                                    <span class="icon-persons round events-none"></span>
                                                    <a class="icontitle events-none">开发一组</a>
                                                    <a class="icon icon-rdoadd right middle"></a>
                                                </div>
                                            </li>
                                        </ul>
                                    </li>
                                </ul>
                            </li>
                            <li id="group-10" data-name="市场体系">
                                <div class="treetitle">
                                    <i class="treeicon"></i>
                                    <span class="icon-persons round events-none"></span>
                                    <a class="icontitle events-none">市场体系</a>
                                    <a class="icon icon-rdoadd right middle"></a>
                                </div>
                                <ul>
                                    <li id="group-11" data-name="上海办">
                                        <div class="treetitle">
                                            <i class="treeicon"></i>
                                            <span class="icon-persons round events-none"></span>
                                            <a class="icontitle events-none">上海办</a>
                                            <a class="icon icon-rdoadd right middle"></a>
                                        </div>
                                    </li>
                                    <li id="group-12" data-name="广州办名字超长超长超长超">
                                        <div class="treetitle">
                                            <i class="treeicon"></i>
                                            <span class="icon-persons round events-none"></span>
                                            <a class="icontitle events-none">广州办名字超长超长超长超</a>
                                            <a class="icon icon-rdoadd right middle"></a>
                                        </div>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
            <!-- /tree -->
        </article>
    </section>
	
	<script src="../plugin/jquery/jquery.min.js"></script>
	<script src="../plugin/seedsui/seedsui.min.js"></script>
	<script>
    var selectedEl=[];
    function onTapTree(){
        var noChildToast = new Toast("没有子部门", {delay:2000});
        /*=============
        Method
        ==============*/
        //selected-box是否为空
        function selectedBox(){
            if($("#selected-box").is(':empty')){
                selectedEl=[];
                $("#selected-box").slideUp();
            }else{
                selectedEl=[];
                $("#selected-box span").each(function(i,n){
                    selectedEl.push($(this).data("id"));
                });
                $("#selected-box").slideDown();
            }
            console.log("选中的ID："+selectedEl);
        }
        /*=============
        点击树
        ==============*/
        EventUtil.addHandler(tree,"tap",function(e){
            var target=e.target,elLI,elIcon,elChildUL;
            //当点击添加时,将所选添加到stautsbar上
            if(target.className.indexOf("icon-rdoadd")>= 0){
                elLI=target.parentNode.parentNode;
                //子节点及自身添加active状态
                $(elLI).find(".treetitle").addClass('active');
                $(elLI).find(".icon-rdoadd").fadeOut();

                //添加到selected-box中
                var treeID=elLI.getAttribute("id");
                var treeName=elLI.getAttribute("data-name");
                var span='<span class="mark-desaturate" data-id="'+treeID+'">'+treeName+'<a class="icon-clear-fill delete-selection"></a></span>';
                $("#selected-box").append(span);

                //selected-box是否为空
                selectedBox();
                //删除selected-box上的子节点
                $(elLI).find("li").each(function(i,n){
                    var id=n.id;
                    $("[data-id='"+id+"']").fadeOut(500,function(){
                        $(this).remove();
                        //selected-box是否为空
                        selectedBox();
                    });
                });

                return;
            }

            //当点击标题时，展开与收缩树
            if(target.className.indexOf("treetitle")>=0){
                selection = e.target;
                elLI=e.target.parentNode;
            } else if(target.className.indexOf("treeicon")>=0){
                elLI=e.target.parentNode.parentNode;
                selection = e.target.parentNode;
            }
            elIcon=elLI.querySelector(".treeicon");
            elChildUL=elLI.querySelector("ul");
            if(!elChildUL){
                noChildToast.show();
                if(elIcon)$(elIcon).remove();
                return;
            }
            //展开与收缩树
            if(elChildUL.style.display=="none" || !elChildUL.style.display){
                //展开
                elIcon.className="treeicon active";
                elChildUL.style.display="block";
            }else{
                //收缩
                elIcon.className="treeicon";
                elChildUL.style.display="none";
            }
        });

        /*=============
        点击selected-box
        ==============*/
        document.getElementById("selected-box").addEventListener("click",function(e){
            var target=e.target;
            if(target.className.indexOf("icon-clear-fill")>= 0){
                var markTarget=target.parentNode;
                var id=$(markTarget).data("id");
                //还原树结构中的active状态
                $("#"+id).find(".treetitle").removeClass("active").find(".icon-rdoadd").fadeIn(500);
                //删除点击的mark
                $(markTarget).fadeOut(500,function(e){
                    $(this).remove();
                    selectedBox();
                })
            }
        },false);
    }

	window.addEventListener("load",function(e){
        //注入数据时，注意根据姓氏获得颜色
        //console.log("成少波".toPinyin().substr(0,1).toColor());

        //给树结构绑定事件
		onTapTree();
	},false);
	//定义exmobi返回
	function back(){history.go(-1);}
	</script>
</body>
</html>
